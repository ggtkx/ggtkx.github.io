<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>2024 金谷拾月游园会电子地图</title>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <!-- 全局状态 通用函数 -->
    <script>
      const mapURL = `/images/2024-map/map.png?cache=${Date().toString()}`;
      const siteStates = {
        selectedLanguage: 'zh',
        isDrawerOpen: false,
        selectedTab: 'guide',
        qrCodeEle: undefined,
        hasPopupOpen: false,
        // phone: '',
        // collectedStamps: [1, 5, 7],
      };

      // Cookies.set('phone', '');
      // Cookies.set('collectedStamps', []);
      function showBoothListPopupFunc(sectionName) {
        if (sectionName === sectionNames.cuisine) {
          boothListEle.innerHTML = cuisinesListHTML;
          sectionNameEle.innerHTML = '美食区';
        } else if (sectionName === sectionNames.kids) {
          boothListEle.innerHTML = kidsListHTML;
          sectionNameEle.innerHTML = '儿童游戏区';
        } else if (sectionName === sectionNames.traditions) {
          boothListEle.innerHTML = traditionsListHTML;
          sectionNameEle.innerHTML = '传统区';
        } else if (sectionName === sectionNames.functions) {
          boothListEle.innerHTML = functionsListHTML;
          sectionNameEle.innerHTML = '功能 & 赞助区';
        }
        openPopup(boothListPopupEle);
        boothListEle.scrollTop = 0;
        document
          .querySelectorAll('.booth-card')
          .forEach((e) => e.addEventListener('click', openBoothDetails));
      }

      function closePopup(popupEle) {
        if (!popupEle) {
          return;
        }
        popupEle.classList.add('display-none');
        popupEle.classList.remove('display-block');
        siteStates.hasPopupOpen = false;
      }
      function openPopup(popupEle) {
        if (!popupEle) {
          return;
        }
        popupEle.classList.add('display-block');
        popupEle.classList.remove('display-none');
        siteStates.hasPopupOpen = true;
      }
    </script>

    <script type="text/javascript" src="https://blog.zgzg.io/custom/js/qrcode.js"></script>

    <!-- 赞助商信息及生成对应html -->
    <script>
      const sponsorsAndCollaboratorsMap = {
        HeCares: {
          name: 'HeCares',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-HeCares/友情合作-HeCares-logo.jpeg',
          qrCode: ['/images/2024-map/sponsors/友情合作-HeCares/HeCares-二维码.png'],
        },
        sjusv: {
          name: '交大校友会',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-交大校友会/友情合作-交大校友会-logo.png',
          qrCode: ['/images/2024-map/sponsors/友情合作-交大校友会/友情合作-交大校友会-二维码.png'],
        },
        chihuo: {
          name: '吃货小分队',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-吃货小分队/友情合作-吃货小分队logo.jpeg',
          qrCode: ['/images/2024-map/sponsors/友情合作-吃货小分队/友情合作-吃货-二维码.jpg'],
        },
        taiyangshen: {
          // 缺logo
          name: '太阳神美院',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-太阳神美院/Logo.PNG',
          qrCode: ['/images/2024-map/sponsors/友情合作-太阳神美院/QRcode.png'],
        },
        xigu: {
          name: '戏谷剧团',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-戏谷剧团/友情合作-戏谷剧团-logo.jpeg',
          qrCode: ['/images/2024-map/sponsors/友情合作-戏谷剧团/友情合作-戏谷剧团-二维码.png'],
        },
        tuokouxiu: {
          name: '硅谷脱口秀',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-硅谷脱口秀/硅谷脱口秀Logo新.png',
          qrCode: ['/images/2024-map/sponsors/友情合作-硅谷脱口秀/硅谷脱口秀二维码.png'],
        },
        aaya: {
          name: 'AAYA',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作方-AAYA/AAYA-logo-中文.png',
          qrCode: ['/images/2024-map/sponsors/友情合作方-AAYA/二维码.jpg'],
        },
        berryfun: {
          name: 'BerryFun',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作方-BerryFun/BerryFun-Logo带字-透明底.png',
          qrCode: ['/images/2024-map/sponsors/友情合作方-BerryFun/BerryFun小红书二维码.PNG'],
        },
        '99ranch': {
          name: '99大华',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-99大华/白金-大华Logo.png',
          qrCode: ['/images/2024-map/sponsors/白金-99大华/白金-大华-二维码.png'],
          details: `下载大华APP，购齐生活所需！生鲜果蔬、生猛活海
鲜、零食饮料、美妆护肤，应有尽有！最快当天送达，
载歌在谷专享：全场订单满$68减$10，优惠码:
ZGZG10。10月万圣节大促：
10.18 - 10.31
10% OFF $60+
15% OFF $80+
20% OFF $100+，无需折扣码，自动满折。新人注册再送
减$20优惠券，活动当天去大华摊位可免费领取零食礼包！
`,
        },
        'balance-better': {
          name: 'Balance & Better',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-Balance-Better/logo-Balance-Better.png',
          qrCode: [
            '/images/2024-map/sponsors/白金-Balance-Better/balanced-better-二维码及文字.png',
          ],
          details: `Are you a HENRY (High Earning Not Rich Yet)?
Are you bothered by high tax burden and wondering about tax-free plans?
Are you wondering about ways of passive income?
Are you wondering how to plan for a “worry-free” retirement?
Balanced & Better Financial Service Team is here to help. 

We are a team of financial professionals backed by 100+ accredited financial institutions. We provide holistic financial strategy education for families, facilitate solutions from kids college tuition funding, LTC (Long Term Care) preparation to retirement planning, estate planning etc.
We strive for professional excellence and Long-Term customer satisfaction.


WeChat ID:  BalancedBetter
Meet us: bit.ly/meet-BB
`,
        },
        juso: {
          name: 'JUSO Home',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-JUSO/Juso_Home_logo-01.png',
          qrCode: [
            '/images/2024-map/sponsors/白金-JUSO/白金-JUSO-Home-二维码1.png',
            '/images/2024-map/sponsors/白金-JUSO/白金-JUSO-Home-二维码2',
          ],
          details: `Juso Home是一家总部坐落于旧金山湾区的家居用品的品牌。专注于打造现代、时尚且优质的家居体验。我们秉承让高端极简设计触手可及的理念，致力于提供亲民且可负担的高品质产品。欢迎您与我们一起，感受精致家居带来的温馨与品味。`,
        },
        lingoace: {
          name: 'Lingoace',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-Lingoace/白金-Lingoace-logo.jpeg',
          qrCode: ['/images/2024-map/sponsors/白金-Lingoace/白金-lingoace-二维码.png'],
          details: `LingoAce 是一家专注于为全球学生提供中文学习的在线教育平台，特别适合3到15岁的儿童。通过结合互动性强的课程设计、丰富多样的教材和资深教师团队，LingoAce 为儿童创造了一种沉浸式的语言学习环境。平台提供个性化的学习体验，帮助孩子们通过趣味性强的方式掌握中文听、说、读、写的技能。

LingoAce 的教学方式以寓教于乐为核心理念，结合游戏化的互动和多媒体资源，激发孩子们的学习兴趣。平台上的教师均为经过严格筛选和专业培训的母语教师，确保学生得到高质量的教学指导。此外，LingoAce 还提供详细的学习报告，帮助家长及时了解孩子的进步情况。

平台的课程设置灵活，家长可以根据孩子的需求和水平自由选择课程，满足不同语言学习目标的需求。无论是初学者还是有一定基础的学生，LingoAce 都致力于为全球儿童提供高效、有趣的中文学习体验。
`,
        },
        tradeup: {
          name: 'TradeUP 老虎证券',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-TradeUP/白金-老虎证券logo.jpeg',
          qrCode: ['/images/2024-map/sponsors/白金-TradeUP/老虎证券二维码.jpeg'],
          details: `TradeUP Securities, Inc.是老虎证券（Nasdaq: TIGR)在美国挂牌营业、有清算资质的证券公司，专注于为全球客户提供迅捷、高质量的证券交易执行、证券清算和全方位金融投资服务。

TradeUP成立于1986年，拥有逾30年的经验，秉承可靠、专业的全球化服务标准，已成为诸多国际零售及机构客户值得信赖的投资伙伴。我们受美国SEC监管，也是FINRA、NYSE、SIPC的会员。

TradeUp is a Nasdaq-listed fintech company that can support your investments with a professional trading system, educational content, and analysis.
`,
        },
        fangtai: {
          name: '方太',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-方太/白金-FOTILE方太-logo-black.png',
          qrCode: [
            '/images/2024-map/sponsors/白金-方太/白金-方太-Cupertino二维码.jpg',
            '/images/2024-map/sponsors/白金-方太/白金-方太-Milpitas二维码.jpg',
            '/images/2024-map/sponsors/白金-方太/白金-方太-UnionCity二维码.jpg',
          ],
          details: `方太近30年来始终致力于通过技术创新，为用户打造更健康幸福的厨房生活。2017年，方太进军美国市场，专为美国更开放宽敞的厨房设计了一系列高端厨电产品，赢得了广大用户的信赖与好评。目前，美国核心城市中每三户华人家庭，就有一户选择方太。凭借强大的实力和卓越的品质，方太连续三年被福布斯评选为“十佳油烟机品牌”，成为唯一上榜的中国出海品牌。`,
        },
        fantuan: {
          name: '饭团',
          tier: 'platinum',
          logo: '/images/2024-map/sponsors/白金-饭团/白金-饭团-logo.png',
          qrCode: ['/images/2024-map/sponsors/白金-饭团/白金-饭团-二维码.png'],
          details: `饭团外卖结合了湾区好吃的好玩的，从【外卖配送】到【生鲜便利】到【到店团购】等多样化服务, 不断开拓业务边界, 帮助用户更好地探索湾区本地生活。为海外华人及所有海外消费者提供更加便捷, 高效, 智能的服务。
现在新人用户还有$100大礼包优惠券。全场独家超值折扣美食、娱乐，让大家感受到家的味道家的温暖，真正做到“轻松生活, 一个饭团就够了”
`,
        },
        ipg: {
          name: 'IPG',
          tier: 'gold',
          logo: '/images/2024-map/sponsors/黄金-IPG/logo.jpg',
          qrCode: ['/images/2024-map/sponsors/黄金-IPG/微信公众号二维码.png'],
          details: `英特利普集团成立于硅谷，专注全球招雇一体化，集团总部位于硅谷，在纽约、伦敦、新加坡、上海、北京、深圳等全球15个核心城市设有分公司。AI人才库11亿，覆盖160+国家，为顶级科技公司提供招聘与雇佣服务，致力于AI驱动的人才匹配。`,
        },
        steve: {
          name: 'Steve Chen',
          tier: 'gold',
          logo: '/images/2024-map/sponsors/黄金-Steve/金牌-Steve-Chen-logo.jpeg',
          qrCode: ['/images/2024-map/sponsors/黄金-Steve/金牌-Steve-Chen-二维码.jpeg'],
          details: `Steve Chen，从业15年的资深房屋贷款经纪。顶尖的团队，凭藉扎实专业知识、丰富沟通技巧、和多年的实战经验，帮助了超过5000个家庭在美国完成购屋的梦想！`,
        },
        hanfushe: {
          name: 'hanfushe',
          tier: 'collaborator',
          logo: '/images/2024-map/sponsors/友情合作-硅谷汉服社/logo.jpg',
          qrCode: [
            '/images/2024-map/sponsors/友情合作-硅谷汉服社/logo简介.jpg',
            '/images/2024-map/sponsors/友情合作-硅谷汉服社/二维码.jpg',
          ],
          details: '',
        },
      };
      const collaboratorsList = [
        'HeCares',
        'sjusv',
        'chihuo',
        'taiyangshen',
        'xigu',
        'tuokouxiu',
        'aaya',
        'berryfun',
        'hanfushe',
      ];
      const sponsorsList = [
        '99ranch',
        'balance-better',
        'juso',
        'lingoace',
        'tradeup',
        'fangtai',
        'fantuan',
        'ipg',
        'steve',
      ];

      const sponsorsIndex = [
        'HeCares',
        'sjusv',
        'chihuo',
        'taiyangshen',
        'xigu',
        'tuokouxiu',
        'aaya',
        'berryfun',
        '99ranch',
        'balance-better',
        'juso',
        'lingoace',
        'tradeup',
        'fangtai',
        'fantuan',
        'ipg',
        'steve',
      ];

      const sponsorsListHTML = sponsorsList
        .map((sponsor, i) => {
          const info = sponsorsAndCollaboratorsMap[sponsor];
          return `
  <div class="sponsor-logo tier-${info.tier}" data-sponsor="${sponsor}">
    <img class="tire-icon" src="/images/2024-map/icon-${info.tier}.png" alt="" />
    <input class="active-selected-sponsor" name="selected-sponsor" type="radio" ${
      i === 0 ? 'checked' : ''
    } />
    <div class="logo-container">
    <img data-sponsor="${sponsor}"
      tabindex="0"
      class="logo-img"
      src="${info.logo}"
      alt="${info.name}"
    />
    </div>
  </div>
  `;
        })
        .join('');

      const collaboratorsListHTML = collaboratorsList
        .map((sponsor, i) => {
          const info = sponsorsAndCollaboratorsMap[sponsor];
          return `
  <div class="sponsor-logo tier-collaborator" data-sponsor="${sponsor}">
    <input class="active-selected-sponsor" name="selected-sponsor" type="radio" ${
      i === 0 ? 'checked' : ''
    } />
    <div  class="logo-container">
    <img
    data-sponsor="${sponsor}"
      class="logo-img"
      src="${info.logo}"
      alt="${info.name}"
    />
    </div>
  </div>
  `;
        })
        .join('');
    </script>

    <!-- 摊位信息及生成对应 html -->
    <script>
      const sectionNames = {
        cuisine: 'cuisine',
        kids: 'kids',
        traditions: 'traditions',
        functions: 'functions',
      };
      const cuisinesList = [
        {
          stampIndex: 'cuisine-1',
          sectionIndexes: [1],
          name: '巴九门烧烤',
          checkin: false,
          price: '$10 - $15',
          details: '',
        },
        {
          stampIndex: 'cuisine-2',
          sectionIndexes: [2],
          name: '甘了蔗杯',
          checkin: true,
          checkinCondition: '买3瓶以上',
          price: '$10',
          details: `Fresh squeezed sugarcane juice always bring fresh , sweet , nutrition .  `,
        },
        {
          stampIndex: 'cuisine-3',
          sectionIndexes: [3],
          name: '沙县小吃',
          checkin: true,
          checkinCondition: '消费满30',
          price: '$8 - $12',
          details: `国民小吃，在中国家喻户晓的沙县小吃`,
        },
        {
          stampIndex: 'cuisine-4',
          sectionIndexes: [4],
          name: 'HE & C Tea + Pot',
          checkin: true,
          checkinCondition: '消费满40或购买5件以上不同的商品',
          price: 'Around $8',
          details: `He& C believes that a cup of tea not only letting us enjoy the symbolic taste but also giving us a quiet and peaceful atmosphere of respect. This calm and peaceful cup helps relieve stress and fatigue. HE&C is fully committed to using the best tea to serve our community and find a beautiful balance in our life.`,
        },
        {
          stampIndex: 'cuisine-5',
          sectionIndexes: [5],
          name: '书亦烧仙草',
          checkin: false,
          price: '$7 - $9',
          details: `书亦烧仙草（Shuyi Grass Jelly & Tea）是一个源自中国的知名茶饮品牌，以传统的烧仙草和创新茶饮为核心产品，深受消费者喜爱。其品牌理念是传承传统茶文化，同时通过创新的方式融入现代元素，打造出具有独特风味和健康特色的饮品。书亦烧仙草不仅注重产品的口感和品质，还注重选用高品质的原材料，如新鲜水果、优质茶叶和天然食材。`,
        },
        {
          stampIndex: 'cuisine-6',
          sectionIndexes: [6],
          name: '貂炸天',
          checkin: true,
          details: '',
        },
        {
          stampIndex: 'cuisine-7',
          sectionIndexes: [7],
          name: '富贵柠手打柠檬茶',
          checkin: true,
          checkinCondition: '消费满$30',
          price: '$10 - $15',
          details: '',
        },
        {
          stampIndex: 'cuisine-8',
          sectionIndexes: [8],
          name: 'CAFÉ KAZKA',
          checkin: true,
          price: '$10',
          details: '',
        },
        {
          stampIndex: 'cuisine-9',
          sectionIndexes: [9],
          name: '士林台湾小吃',
          checkin: true,
          price: '$12 - $15',
          details: '',
        },
        {
          stampIndex: 'cuisine-10',
          sectionIndexes: [10],
          name: '99大華',
          checkin: true,
          details: '',
        },
      ];
      const kidsList = [
        {
          stampIndex: 'kids-1',
          sectionIndexes: [1],
          name: '跃动天地',
          checkin: true,
          free: true,
          checkinCondition: {
            html: `
          <div>
            <ul>
              <li>
                [Diabolo]
                <ul>
                  <li>For 13 and under: Play the diablo continuously for 10 seconds</li>
                  <li>For 14 and above: Play the diablo continuously for 20 seconds</li>
                </ul>
              </li>
              <li>
                [Pitch Pot]
                <ul>
                  <li>For all age range: Make 2 or more out of 10 total attempts</li>
                </ul>
              </li>
              <li>
                [Jianzi]
                <ul>
                  <li>For 13 and under: Get 3 in a row without dropping</li>
                  <li>For 14 and above: Get 5 in a row without dropping</li>
                </ul>
              </li>
              <li>
                [Jump Rope]
                <ul>
                  <li>For 13 and under: Do 20 continuously without tripping</li>
                  <li>For 14 and above: Do 30</li>
                </ul>
              </li>
            </ul>
          </div>
            `,
          },
          price: '$0',
          details: `通过完成抖空竹，投壶，踢键子，或者跳绳，来获取活动徽章！
Get a stamp by Diabolo, Pitch Pot, Jianzi, or rope jumping! `,
        },
        {
          stampIndex: 'kids-2',
          sectionIndexes: [2],
          name: '叠叠乐',
          checkin: true,
          free: true,
          price: '$0',
          details: `由玩家轮流将下方的积木抽出，堆叠到塔的最上层。 积木塔倒塌即为游戏结束，最后移动积木的玩家为输。
Take one block on a turn from any level of the tower (except the one below an incomplete top level), and place it on the topmost level in order to complete it. The game ends when the tower falls -- completely or if any block falls from the tower (other than the block a player moves on a turn). `,
        },
        {
          stampIndex: 'kids-3',
          sectionIndexes: [3],
          name: '钓鱼',
          checkin: true,
          free: true,
          price: '$0',
          details: `儿童钓鱼小游戏。
Fishing Game for children. `,
        },
        {
          stampIndex: 'kids-4',
          sectionIndexes: [4],
          name: 'Silicon Valley Youth',
          checkin: true,
          checkinCondition: '完成摊位活动',
          price: '$3',
          includedInTicket: true,
          details: `【组织介绍】
Silicon Valley Youth is a student-run nonprofit educational and community service organization under the provisions of section 501(c)(3) of the Internal Revenue Code.
Our mission is to develop the intellectual, moral, civic, and creative capabilities of youth so they can serve and lead our society.
Silicon Valley Youth is an official certifying organization for the President's Volunteer Service Award.
All profits go toward supporting education and creating equal opportunities for all students.
【摊位活动】
1. 投壺遊戲：轮流将箭杆投抛至酒壶内
2. 有奖问答游戏：競答不同类型的题目換獎品`,
        },
        {
          stampIndex: 'kids-5',
          sectionIndexes: [5],
          name: '百变气球',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `一起来制作形状百变的气球吧！
Let's twist balloons to inspire your creativity! `,
        },
        {
          stampIndex: 'kids-6',
          sectionIndexes: [6],
          name: '自制徽章',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `一起来制作独属于你的徽章吧！
DIY your unique badge here! `,
        },
        {
          stampIndex: 'kids-7',
          sectionIndexes: [7],
          name: '漆扇',
          checkin: true,
          price: '$6',
          includedInTicket: true,
          details: `以漆为笔，以水为墨，具有绝美东方色彩的“漆扇”也由此而生，漆扇，以扇子为载体，运用国家级非遗漆染工艺手工染制而成的艺术品。载歌在谷漆扇铺子将帮助每一位顾客制作完成属于自己的，独一无二的扇子。
漆扇的主题将在不同时段提供：荷塘月色，菜籽花田，紫气东来，十里芳菲，落日晚霞，蓝色星球，阿勒泰等色系。
Use lacquer as the brush and water as the ink to create your own lacquer fan artwork! Themes for the lacquer fans will be offered at different times, including: 'Lotus Pond Under Moonlight,' 'Rapeseed Flower Field,' 'Purple Aura From the East,' 'Ten Miles of Fragrance,' 'Sunset Glow,' 'Blue Planet,' and 'Altay,' among others.`,
        },
        {
          stampIndex: 'kids-8',
          sectionIndexes: [8],
          name: '万花筒',
          checkin: true,
          price: '$3',
          includedInTicket: true,
          details: `万花筒DIY制作，工作人员提供材料和指导，快来制作属于自己独一无二的万花筒吧！
Let's DIY your unique Kaleidoscope together! `,
        },
        {
          stampIndex: 'kids-9',
          sectionIndexes: [9],
          name: '闪亮画艺坊',
          checkin: true,
          price: '钻石画 $3',
          includedInTicket: true,
          details: `闪亮画艺坊专门为您提供美丽闪耀的钻石贴画和炫彩刮画纸。无论是儿童、还是喜欢DIY的成人，在我们的店铺都能体验创作的乐趣和成就感。
DIY diamond paintings by sticking small resin 'diamonds' onto a canvas to create a mosaic-like picture. Or DIY a colorful scratch art painting by scratching off black coating to reveal colorful patterns underneath. `,
        },
        {
          stampIndex: 'kids-10',
          sectionIndexes: [10],
          name: '活字印刷',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `尝试使用活字印刷来制作你的印刷作品吧！
Let's try the traditional movable type printing to create your own piece! `,
        },
        {
          stampIndex: 'kids-11',
          sectionIndexes: [11],
          name: '面部彩绘',
          checkin: true,
          details: `志愿者将为您提供画脸服务。
We'll paint on your face! `,
        },
        {
          stampIndex: 'kids-12',
          sectionIndexes: [12],
          name: 'LingoAce',
          checkin: true,
          price: '成人 $10，儿童 $5',
          details: '',
        },
        {
          stampIndex: 'kids-13',
          sectionIndexes: [13],
          name: '太阳神美院',
          checkin: true,
          details: '',
        },
      ];
      const traditionsList = [
        {
          stampIndex: 'chinese-1',
          sectionIndexes: [1],
          name: '书法',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `书法练习，在灯笼上书写或绘画。
Let's practice calligraphy by writing and drawing on lanterns!`,
        },
        {
          stampIndex: 'chinese-2',
          sectionIndexes: [2],
          name: '灯谜',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `自选3个灯谜，答对盖章。
Choose 3 lantern riddles, get a stamp if you got the correct answers.`,
        },
        {
          stampIndex: 'chinese-3',
          sectionIndexes: [3],
          name: '诗词大会',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `飞花令，诗词抽签。
Fei Hua Ling & Poetry Lottery. `,
        },
        {
          stampIndex: 'chinese-4',
          sectionIndexes: [4],
          name: '一游未尽桌游',
          checkin: true,
          checkinCondition: '消费满30',
          price: '$10 - $50',
          details: `Toby’s Board Game Club offers a wide range of services to enhance your board game experience. Our knowledgeable staff can recommend and teach you games, and help you find partners to play with. We also offer selections of board games and blind boxes to purchase at the store.`,
        },
        {
          stampIndex: 'chinese-5',
          sectionIndexes: [5],
          name: 'Cookie’s Treat宠物烘焙',
          checkin: true,
          checkinCondition: '消费满30',
          price: '$8 - $36',
          details: '',
        },
        {
          stampIndex: 'chinese-6',
          sectionIndexes: [6],
          name: '24:01 Bloom & Craft',
          checkin: true,
          checkinCondition: '消费满25',
          price: '$10 - $50',
          details: '',
        },
        {
          stampIndex: 'chinese-7',
          sectionIndexes: [7],
          name: '茉茉手作',
          checkin: true,
          checkinCondition:
            '我们是一家实体店铺，希望可以帮助店铺的社交账号引流，并且尽可能的避免强制消费。所以我们希望是关注小红书或者Ins，并且加入微信群即可获得盖章。如需要提高门槛，我们也可以按照消费$15计算。',
          price: '$3 - $100',
          details: `Here’s a more polished and attractive version:  ---  **Momo Handmade** is a women-led local business where every day is an invitation to create, relax, and explore culture through the beauty of handcrafted art. We specialize in offering professional courses on intangible cultural heritage crafts, providing an extensive selection of premium materials and an inspiring environment for DIY projects. At Momo Handmade, we empower you to develop new skills, unwind from daily stresses, enhance your artistic sense, and connect with the rich traditions of craftsmanship. Embrace the joy of making something meaningful with us.`,
        },
        {
          stampIndex: 'chinese-8',
          sectionIndexes: [8],
          name: 'Squishyverse',
          checkin: true,
          checkinCondition: '满$35-$5',
          details: '',
        },
        {
          stampIndex: 'chinese-9',
          sectionIndexes: [9],
          name: '织月亮',
          checkin: true,
          checkinCondition: '消费满30',
          price: '$4.99 - $22.99',
          details: '',
        },
        {
          stampIndex: 'chinese-10',
          sectionIndexes: [10],
          name: '天工坊',
          checkin: true,
          price: '成人 $10，儿童 $2',
          includedInTicket: true,
          details: `1.成人区(14岁以上）-从工作人员处领取材料，开始创作。
2.儿童区-工作人员协助小朋友进行制作。因胶枪热度，小朋友不可以单独进行制作。
1. Adults (>14 years of age) - Pick up materials from the staff and start creating.
2. Children (<=14 years old) - Ask our staff for assistance. Participants need to be accompanied by our staff because of the glue gun's high temperature.`,
        },
        {
          stampIndex: 'chinese-11',
          sectionIndexes: [11],
          name: 'JUSO居所休息空间',
          checkin: true,
          details: '',
        },
        {
          stampIndex: 'chinese-12',
          sectionIndexes: [12],
          name: '许愿墙',
          checkin: true,
          price: '$2',
          includedInTicket: true,
          details: `许愿墙从工作人员处领取许愿卡，写下心愿或祈福。悬挂在指定地点。表达对未来的期望和祈愿。 
A wishing wall allows participants to receive wishing cards from the staff, write down their wishes or prayers, and hang them in a designated area. This process expresses their hopes and blessings for the future.`,
        },
        {
          stampIndex: 'chinese-13',
          sectionIndexes: [13],
          name: 'KissFingers Press-on Nails',
          checkin: true,
          checkinCondition: '购买 3 件商品以上',
          price: '$15 - $25',
          details: `all hand made press on nails. Asian style. paint on nails 购买3件商品以上可盖章`,
        },
        {
          stampIndex: 'chinese-14',
          sectionIndexes: [14],
          name: 'AI汉服照片书',
          checkin: true,
          price: '$0 - $100',
          details: `用AI定制汉服写真照 并打印成照片书`,
        },
        {
          stampIndex: 'chinese-15',
          sectionIndexes: [15],
          name: 'Luckydodo',
          checkin: true,
          price: '$1 - $15',
          details: '',
        },
        {
          stampIndex: 'chinese-16',
          sectionIndexes: [16],
          name: '汉服妆造',
          checkin: true,
          price: '$40',
          details: `古风化妆，做古风发型。
Chinese traditional makeup and hair styling.`,
        },
        {
          stampIndex: 'chinese-17',
          sectionIndexes: [17],
          name: '拍照墙&古琴',
          checkin: true,
          free: true,
          price: '$0',
          details: '',
        },
        {
          stampIndex: 'chinese-18',
          sectionIndexes: [18],
          name: 'Taro姻缘墙 & 戏谷剧团',
          checkin: true,
          price: '$5',
          includedInTicket: true,
          details: '',
        },
        {
          stampIndex: 'chinese-19',
          sectionIndexes: [19],
          name: '糖画',
          checkin: true,
          price: '$6',
          includedInTicket: true,
          details: `自己创作或临摹底图，来创造独特的糖画吧！
Let's create your own sugar painting from scratch, or using the template we provide! `,
        },
      ];
      const functionsList = [
        {
          stampIndex: 'function-1',
          sectionIndexes: [1],
          name: '志愿者休息区1',
          checkin: false,
          details: '',
        },
        {
          stampIndex: 'function-2',
          sectionIndexes: [2],
          name: '失物招领处',
          checkin: false,
          details: '',
        },
        {
          stampIndex: 'function-3',
          sectionIndexes: [3],
          name: '载歌在谷 - 云集',
          checkin: true,
          price: '$0',
          details: `云集是载歌在谷旗下各种社团的集合，运营组会协助大家定期举办团建活动，通过共同的兴趣爱好相互了解，一起搞事情😏🥰👏我们的四大社团分别是：
✅【职】挂云帆：职场分享类🧑‍💻💼
✅【书】影婆娑：读书观影📖🎬
✅体【娱】风云：体育娱乐类🏀🏹
✅一饱【演】福：文艺表演类🎵💃
We are the gallery of activity clubs in ZGZG. Come to join us on weekends! We host a variety of Event - workplace skills-sharing seminars, book / movie nights, sports events, and musical performances. `,
        },
        {
          stampIndex: 'function-4',
          sectionIndexes: [4],
          name: '饭团',
          checkin: true,
          details: '',
        },
        {
          stampIndex: 'function-5',
          sectionIndexes: [5],
          name: 'Balance & Better Family Financial',
          checkin: true,
          details: '',
        },
        {
          stampIndex: 'function-6',
          sectionIndexes: [6],
          name: '老虎证券',
          checkin: true,
          details: '',
        },
        {
          stampIndex: 'function-78',
          sectionIndexes: [7, 8],
          name: '签到/兑奖处1',
          checkin: false,
          details: '',
        },
        {
          stampIndex: 'function-9',
          sectionIndexes: [9],
          name: 'HeCares急救站',
          checkin: true,
          details: '',
        },
        {
          stampIndex: 'function-10',
          sectionIndexes: [10],
          name: '志愿者休息区2',
          checkin: false,
          details: '',
        },
        {
          stampIndex: 'function-1112',
          sectionIndexes: [11, 12],
          name: '签到/兑奖处2',
          checkin: false,
          details: '',
        },
        {
          stampIndex: 'function-13',
          sectionIndexes: [13],
          name: '方太',
          checkin: true,
          details: '',
        },
      ];

      const allBooths = [...cuisinesList, ...kidsList, ...traditionsList, ...functionsList];

      function generateBoothListHTML(boothList, sectionName) {
        const collectedStamps = Cookies.getJSON('collectedStamps');
        return boothList
          .map((booth) => {
            let stampStatus = '';
            if (booth.checkin && collectedStamps?.includes(booth.stampIndex)) {
              stampStatus = `<div class="booth-stamp-status booth-tag">✅</div>`;
            }
            const supportCheckin = booth.checkin
              ? `<div class="booth-tag" style="
                    color: rgb(206,15,4);
                    background: rgb(247,216,215);
                    border-radius: 4px;
                    width: 1.4rem;
                    height: 1.4rem;
                    text-align: center;
                    display: flex;
                    align-content: center;
                    justify-content: center;
                    align-items: center;
                ">章</div>`
              : '';
            const includedInTicket = booth.includedInTicket
              ? `<div class="booth-tag" style="
                    color: rgb(156,88,2);
                    background: rgb(239,228,214);
                    border-radius: 4px;
                    width: 1.4rem;
                    height: 1.4rem;
                    text-align: center;
                    display: flex;
                    align-content: center;
                    justify-content: center;
                    align-items: center;
                ">畅</div>`
              : '';
            const free = booth.free
              ? `<div class="booth-tag" style="
                    color: rgb(48,176,199);
                    background: rgb(222,242,246);
                    border-radius: 4px;
                    width: 1.4rem;
                    height: 1.4rem;
                    text-align: center;
                    display: flex;
                    align-content: center;
                    justify-content: center;
                    align-items: center;
                ">免</div>`
              : '';

            const sectionIndexHtmls = booth.sectionIndexes
              .map((index) => {
                return `<div class="booth-number booth-section-${sectionName}">${index}</div>`;
              })
              .join('');

            return `<div class="booth-card" data-booth-name="${booth.name}">
            ${sectionIndexHtmls}
            <div class="booth-name">${booth.name}</div>
            <div class="booth-tags">
              ${stampStatus}
              ${supportCheckin}
              ${includedInTicket}
              ${free}
            </div>
            <div style="height: 100%;
                  width: 1rem;
                  display: flex;
                  justify-content: center;
                  align-content: center;
                  align-items: center;
                  margin-right: 0.5rem;">
              <img src="/images/2024-map/arrow.png" alt="" style="object-fit: contain;
    height: 1.2rem; transform: translate(0px, 2px);"/>
            </div>
            <div class="arrow"></div>
          </div>`;
          })
          .join('');
      }

      function openBoothDetails(e) {
        const boothName = e.currentTarget.getAttribute('data-booth-name');

        const selectedBooth = allBooths.find((b) => b.name === boothName);

        let checkinCondition = '';

        if (selectedBooth.checkin && selectedBooth.checkinCondition) {
          if (selectedBooth.checkinCondition.html) {
            checkinCondition = `
              <h3 style="text-align: center;">打卡条件</h3>
              ${selectedBooth.checkinCondition.html}
            `;
          } else {
            checkinCondition = `
              <h3 style="text-align: center;">打卡条件</h3>
              ${selectedBooth.checkinCondition}
              `;
          }
        }

        boothDetailsEle.innerHTML = `
          <div style="display: flex;
              flex-wrap: wrap;
              align-content: center;
              justify-content: center;
              align-items: center;">
            <h2>${boothName}</h2>
            <div>
              ${selectedBooth.details}
            </div>
            <div style="    width: 100%;
    text-align: center;">
              ${checkinCondition}
              </div>
            </div>
          `;
        boothDetailsEle.classList.remove('display-none');

        returnToBoothListBtn.classList.remove('display-none');

        boothListEle.classList.add('display-none');
      }

      function returnToBoothList() {
        boothDetailsEle.classList.add('display-none');
        boothListEle.classList.remove('display-none');
        returnToBoothListBtn.classList.add('display-none');
        boothDetailsEle.scrollTop = 0;
      }

      let cuisinesListHTML = generateBoothListHTML(cuisinesList, sectionNames.cuisine);
      let kidsListHTML = generateBoothListHTML(kidsList, sectionNames.kids);
      let traditionsListHTML = generateBoothListHTML(traditionsList, sectionNames.traditions);
      let functionsListHTML = generateBoothListHTML(functionsList, sectionNames.functions);
    </script>

    <!-- 生成二维码 -->
    <script>
      function generateQR() {
        const phone = Cookies.get('phone');
        const url = `https://zgzg.io/stamp?phone=${phone}`;
        if (siteStates.qrCodeEle) {
          return;
        } else {
          const ele = document.createElement('DIV');
          new QRCode(ele, {
            text: url,
            width: 200,
            height: 200,
            colorDark: 'red',
            colorLight: '#ffffff',
            correctLevel: QRCode.CorrectLevel.H,
          });
          siteStates.qrCodeEle = ele;
        }
      }
    </script>

    <!-- 打开打卡记录弹窗及获取打卡信息 -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
      import {
        collection,
        query,
        where,
        getDocs,
        getFirestore,
      } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js';

      const firebaseConfig = {
        apiKey: 'AIzaSyA32iYcPDmH7MJLFKpadSkUuR4K3avEYeA',
        authDomain: 'zgzg-9e6d0.firebaseapp.com',
        projectId: 'zgzg-9e6d0',
        storageBucket: 'zgzg-9e6d0.appspot.com',
        messagingSenderId: '807744488876',
        appId: '1:807744488876:web:bf6ddbfe0b5ab49f216609',
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);

      const db = getFirestore(app);

      window.firebaseQuery = query(collection(db, 'stamps'), where('phone', '==', '7895643212'));
      window.getDocs = getDocs;
    </script>

    <!-- CSS resetting 和 全局 class -->
    <style>
      body {
        padding: 0;
        margin: 0;
        overflow: hidden;
        height: 0;
        background-color: #ffeeab;
        font-family: sans-serif;
        /* 防止 iOS safari 缩放 */
        touch-action: pan-x pan-y;
      }

      .display-block {
        display: block !important;
      }

      .display-none {
        display: none !important;
      }
      .btn-close {
        position: absolute;
        right: 0.5rem;
        top: 0.5rem;
        height: 2rem;
        width: 2rem;
        background: white;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        font-size: 1.5rem;
        font-weight: bolder;
        text-align: center;
      }
    </style>

    <!-- Map Styles -->
    <style>
      #map-container {
        max-width: 100vw;
        /* max-height: calc(100vh - env(safe-area-inset-bottom)); */
        width: 100vw;
        /* height: calc(100vh - env(safe-area-inset-bottom)); */
        overflow: hidden;
      }
      #map {
        width: 100%;
        object-fit: contain;
        /* height: 100%; */
      }
    </style>

    <!-- Drawer Styles -->
    <style>
      #drawer {
        z-index: 100;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
        box-shadow: 0px -3px 27px 14px #0000007d;
      }

      #drawer-slider-container {
        display: flex;
        justify-content: center;
      }

      #drawer-slider {
        width: 65px;
        height: 7px;
        border-radius: 16px;
        margin-top: 5px;
        border: none;
      }

      .drawer-tab-group {
        display: flex;
        justify-content: space-between;
        margin: 1rem 1rem 0 1rem;
      }

      .drawer-tab {
        padding: 0.5rem 1rem;
        border-radius: 0.7rem;
        min-width: 4rem;
        display: flex;
        justify-content: center;
        background-color: #ffd400;
      }

      .drawer-tab__active {
        opacity: 100%;
      }

      .drawer-tab__inactive {
        opacity: 24%;
      }

      .drawer-content__container {
        margin: 1rem 1rem 0 1rem;
        overflow-y: scroll;
      }

      #drawer-content {
        animation-fill-mode: forwards;
        height: 3vh;
        /* width: 100vw; */
      }

      #drawer-content > * {
        max-width: 100%;
      }

      .drawer-open {
        animation-name: slideUp;

        animation-duration: 0.2s;
        animation-timing-function: ease-out;
      }

      .drawer-close {
        animation-name: slideDown;

        animation-duration: 0.2s;
        animation-timing-function: ease-out;
      }

      @keyframes slideUp {
        from {
          height: 3vh;
        }

        to {
          height: 60vh;
        }
      }

      @keyframes slideDown {
        from {
          height: 60vh;
        }

        to {
          height: 3vh;
        }
      }
    </style>

    <!-- 节目单 样式 -->
    <style>
      .show-info-card {
        position: relative;
      }
      .show-time {
        padding: 1rem 0;
        font-size: 1.5rem;
        font-weight: bold;
      }

      .show-info {
        left: 0;
        right: 0;
        height: 150px;
        backdrop-filter: grayscale(60%);
        position: absolute;
      }
      .show-title {
        font-size: 2rem;
        margin: 0.5rem;
      }
      .show-intro {
        margin: 0.5rem;
      }
      img.show-bg-img {
        object-fit: cover;
        width: 100%;
        height: 150px;
        border-radius: 0.5rem;
      }

      ul.show-list {
        background: #edf4f7;
        border-radius: 0.7rem;
        padding-right: 0.5rem;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        padding-inline-start: 2rem;
        margin-top: 0;
      }
      .show-list-time {
        padding-left: 1rem;
        margin-bottom: 0.5rem;
        margin-top: 1.5rem;
      }

      .lottery-info {
        background: #edf4f7;
        border-radius: 0.7rem;
        padding: 0.5rem;
      }
      .lottery-info h4 {
        margin: 0;
        color: #ce0f04;
      }
      .lottery-info p {
        margin: 0.5rem 0;
      }
      .lottery-info ol {
        margin: 0;
      }
    </style>

    <!-- Sponsors Tab Styles -->
    <style>
      .sponsor-tab-group {
        display: flex;
        justify-content: space-between;
        /* margin-top: 1rem; */
        position: fixed;
        /* width: 100%; */
        z-index: 100;
        background: white;
        padding: 2px;
        left: 1rem;
        right: 1rem;
        border: 1px solid #f5be00;
        border-radius: 0.7rem;
      }
      #sponsorTabContainer {
        margin-top: 3rem;
      }

      .sponsor-tab {
        padding: 0.5rem 1rem;
        border-radius: 0.7rem;
        min-width: 4rem;
        display: flex;
        justify-content: center;
        background-color: #ffd400;
        width: 40%;
      }

      .sponsor-tab__active {
        opacity: 100%;
      }

      .sponsor-tab__inactive {
        opacity: 24%;
      }

      .sponsor-container {
        /* margin: 1rem 1rem 0 1rem; */
        overflow-y: scroll;
      }
      #sponsorLogoGroup {
        /* width: 500px; */
        /* height: 100px; */
        white-space: nowrap;
        position: relative;
        overflow-x: scroll;
        overflow-y: hidden;
        margin-top: 1rem;
      }
      .sponsor-logo {
        /* width: 100px; */
        /* background-color: #eee; */
        /* float: none; */
        /* height: 100px; */
        margin: 0 0.5rem;
        display: inline-block;
        /* zoom: 1; */
        position: relative;
      }

      .sponsor-logo img.logo-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        opacity: 0.2;
        -moz-opacity: 0.2; /* Firefox and Mozilla browsers */
        -webkit-opacity: 0.2;
      }

      .logo-container {
        /* border-radius: 100%; */
        /* border: 5px solid transparent; */
        padding: 3px;
        /* filter: opacity(0.5); */
        width: 100%;
        height: 100%;
      }

      .tier-platinum {
        width: 150px;
        height: 150px;
      }

      .tier-gold {
        width: 100px;
        height: 100px;
      }

      .tier-collaborator {
        width: 50px;
        height: 50px;
      }

      input.active-selected-sponsor {
        position: absolute;
        left: 0;
        top: 0;

        z-index: 1;
        opacity: 0;
        display: block;
      }

      input.active-selected-sponsor:checked + .logo-container > .logo-img {
        opacity: 1;
        -moz-opacity: 1; /* Firefox and Mozilla browsers */
        -webkit-opacity: 1;
      }

      img.tire-icon {
        position: absolute;
        width: 20px;
        height: 20px;
        right: 0;
        bottom: 0;
        z-index: 50;
      }

      .sponsor-details {
      }

      img.sponsor-qr {
        width: 100%;
        object-fit: contain;
      }
    </style>

    <!-- 打卡入口样式 -->
    <style>
      .checkin-button-container {
        position: absolute;
        top: -62px;
        left: 0;
        right: 0;
        display: flex;
        height: 50px;
        justify-content: space-evenly;
      }

      .checkin-button {
        background: linear-gradient(45deg, rgba(240, 220, 220), rgb(254, 247, 216));
        border-radius: 0.7rem;
        width: 90%;
        display: flex;
        align-items: center;
      }

      .checkin-button-logo {
        object-fit: contain;
        height: 80%;
        margin-right: 10px;
        margin-left: 10px;
      }

      #showCheckinHistory,
      #showQRCode {
        background: linear-gradient(45deg, rgba(240, 220, 220), rgb(254, 247, 216));
        border-radius: 0.7rem;
        width: 45%;
        display: flex;
        align-items: center;
      }
    </style>

    <!-- 打卡记录弹窗样式 -->
    <style>
      #checkinHistoryPopup {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, #ffe1b4, white);
        height: 80%;
        z-index: 200;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        box-shadow: 0px -68px 66px 27px #0000007d;
      }

      #checkinHistoryPopup h1 {
        text-align: center;
      }

      #checkinHistoryPopup p {
        text-align: center;
      }

      .stamp-cards-list {
        display: grid;
        padding: 0 1rem;
        /* flex-wrap: wrap; */
        justify-content: center;
        overflow-y: scroll;
        height: 70%;
        grid-template-columns: 40% 40%;
        gap: 10px;
        align-items: center;
        justify-items: center;
      }

      .stamp-card {
        position: relative;
        width: 100%;
        height: 125px;
        display: flex;
        /* align-content: center; */
        justify-content: center;
        align-items: center;
      }

      .stamp-name {
        font-size: 2.2rem;
        font-weight: bolder;
        text-align: center;
        justify-items: center;
      }

      .stamp-card img {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 5rem;
      }
    </style>

    <!-- 输入手机号样式 -->
    <style>
      #registerPopup {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, #ffe1b4, white);
        height: 50%;
        z-index: 200;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        box-shadow: 0px -68px 66px 27px #0000007d;
      }

      #registerPopup h1 {
        text-align: center;
      }
    </style>

    <!-- 二维码弹窗样式 -->
    <style>
      #qrCodePopup {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, #ffe1b4, white);
        height: 50%;
        z-index: 200;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        box-shadow: 0px -68px 66px 27px #0000007d;
      }

      #qrCodePopup h1 {
        text-align: center;
        margin-bottom: 0.2rem;
      }
      #qrCodePopup p {
        text-align: center;
        margin-top: 0;
      }

      #qrCodeContainer {
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>

    <!-- 摊位列表样式 -->
    <style>
      #boothListPopup {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, #ffe1b4, white);
        height: 80%;
        z-index: 200;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        box-shadow: 0px -68px 66px 27px #0000007d;
      }

      #boothListPopup h1 {
        text-align: center;
      }
      #boothList {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: scroll;
        height: 70%;
        padding-top: 1rem;
      }

      #boothDetails {
        padding: 0 1rem;
      }

      #returnToBoothListBtn {
        position: absolute;
        top: 0.5rem;
        left: 0.5rem;
        width: 1rem;
        height: 1rem;
        padding: 0.5rem;
        background-color: white;
        border-radius: 50%;
      }

      #returnToBoothListBtn img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        -moz-transform: scale(-1, -1);
        -o-transform: scale(-1, -1);
        -webkit-transform: scale(-1, -1);
        transform: scale(-1, -1);
      }
      .booth-card {
        margin-bottom: 1rem;
        border-radius: 0.7rem;
        border: 1px black solid;
        width: 90%;
        display: flex;
        align-items: center;
      }
      .booth-number {
        width: 2rem;
        height: 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 10px;
        margin-right: 0;
        border-radius: 0.7rem;
        color: white;
        font-weight: bold;
      }
      .booth-name {
        display: flex;
        align-items: center;
        margin-left: 10px;
      }
      .booth-stamp-status {
        margin-left: auto;
      }

      .booth-tags {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-left: auto;
        margin-right: 0.5rem;
      }
      .booth-tag {
        height: 100%;
        margin-right: 0.3rem;
      }

      .booth-section-cuisine {
        background-color: #ff9500;
      }
      .booth-section-kids {
        background-color: #008c41;
      }
      .booth-section-traditions {
        background-color: #007aff;
      }
      .booth-section-functions {
        background-color: #ff2d55;
      }
    </style>

    <!-- 中英文切换文本设定  -->
    <script>
      const i18nStrings = {
        'payInfo.coin': {
          zh: '代币支付',
          en: 'Coin',
        },
        'payInfo.cash': {
          zh: '现金支付',
          en: 'Cash',
        },
        langSwitch: {
          zh: 'English',
          en: '中文',
        },
        'drawer.tab.guide': {
          zh: '游园指南',
          en: 'Guide',
        },
        'drawer.tab.shows': {
          zh: '节目单',
          en: 'Shows',
        },
        'drawer.tab.guide.sponsors': {
          zh: '赞助&合作',
          en: 'Sponsors',
        },
      };
    </script>

    <!-- 节目单信息 -->
    <script>
      const showsList = [
        {
          title: '演出标题',
          intro:
            '演出简介，没错，就是简介。一两句话，一两行的那种。演出简介，没错，就是简介。一两句话，一两行的那种。',
          time: '12:00 PM',
          image: '/images/2024-map/content.png',
        },
        {
          title: '演出标题',
          intro:
            '演出简介，没错，就是简介。一两句话，一两行的那种。演出简介，没错，就是简介。一两句话，一两行的那种。',
          time: '12:00 PM',
          image: '/images/2024-map/content.png',
        },
        {
          title: '演出标题',
          intro:
            '演出简介，没错，就是简介。一两句话，一两行的那种。演出简介，没错，就是简介。一两句话，一两行的那种。',
          time: '12:00 PM',
          image: '/images/2024-map/content.png',
        },
        {
          title: '演出标题',
          intro:
            '演出简介，没错，就是简介。一两句话，一两行的那种。演出简介，没错，就是简介。一两句话，一两行的那种。',
          time: '12:00 PM',
          image: '/images/2024-map/content.png',
        },
      ];
    </script>

    <!-- 顶层 tab 动态内容 html -->
    <script>
      const tourGuideHTMLContent = `
      <img
              src="/images/2024-map/tourGuide.png"
              alt=""
            /> 
      `;
      // const showListHTMLContent = showsList
      //   .map((show) => {
      //     return `
      //   <div class="show-list-container">
      //         <div class="show-info-card">
      //           <div class="show-time">
      //             <span>${show.time}</span>
      //           </div>
      //           <div class="show-info">
      //             <div class="show-title">${show.title}</div>
      //             <div class="show-intro">
      //               ${show.intro}
      //             </div>
      //           </div>
      //           <img class="show-bg-img" src="${show.image}" alt="" />
      //         </div>
      //       </div>
      //   `;
      //   })
      //   .join('');
      const showListHTMLContent = `<div class="show-list-card">
              <h3 class="show-list-time">1:00 PM - 3:40 PM</h3>
              <ul class="show-list">
                <li>Batter Up | Twinkle by Tingna Dance Studio</li>
                <li>Woman Up | Extremer</li>
                <li>弦樂團金曲串燒 Rhapsody String Ensemble | 狂响弦乐团</li>
                <li>Put your records on | Aevum Mistry</li>
                <li>舞蹈串烧《穿越》 | DD舞团</li>
                <li>是妈妈是女儿 | Zoe and Jade Worden</li>
                <li>国乐雅秋 The Fall Melody by Guqin, Bamboo flute and Hulusi | 雅韵国乐社</li>
                <li>少林雄风 | Shaolin Warrior Martial Arts</li>
                <li>祥狮欢舞迎金秋 | Leland High School Lion Dance Team</li>
                <li>华夏有衣-汉服走秀 Chinese Dress Fashion Show | 硅谷汉服社</li>
                <li>古琴演奏 | 太玄古琴社</li>
                <li>传承 | Song's Kung Fu</li>
                <li>
                  儿童舞蹈《花木兰》《森林圆舞曲》《奇妙的小仙子 》| Dream Hope Star Dance Academy
                </li>
                <li>越剧清唱《追鱼》 | Xiaowen Geng</li>
                <li>舞蹈 - 红昭愿 | 85Fun Studio</li>
                <li>月光+蝶 | 丁梦</li>
                <li>中提琴独奏《渔舟唱晚》 | 黄佳艺</li>
                <li>中英文歌曲串烧 Mashup | 兰兰</li>
              </ul>
            </div>
            <div class="show-list-card">
              <h3 class="show-list-time">4:10 pm - 4:40 pm</h3>
              <ul class="show-list">
                <li>Band: Why Sol Serious</li>
              </ul>
            </div>
            <div class="show-list-card">
              <h3 class="show-list-time">4:40 pm - 5:10 pm</h3>
              <div class="lottery-info">
                <h4>舞台抽奖 Lottery!</h4>
                <p>
                  Join Stage lottery to win the grand prize worth
                  <span style="color: #ce0f04; font-weight: bold">$719!</span>
                </p>
                <p style="font-weight: bold">可通过以下方式获取抽奖券，以参与舞台抽奖：</p>
                <ol>
                  <li>购买售价 $35 的畅玩券赠送 3 张</li>
                  <li>购买 ≧$15 的代币赠送 1 张</li>
                  <li>购买 ≧$30 的代币赠送 2 张</li>
                  <li>提前 24 小时注册活动赠送 1 张</li>
                </ol>
                <p style="font-weight: bold">
                  How to obtain stage lottery ticket to join the stage lottery?
                </p>
                <ol>
                  <li>Purchase ZGZG-all inclusive ticket ($35) - 3 tickets</li>
                  <li>Purchase ZGZG tokens ≧ $15 - 1 ticket</li>
                  <li>Purchase ZGZG tokens ≧ $30 - 2 tickets；</li>
                  <li>Register 24 hours before event start (before Oct 19 2024, PST 12pm)</li>
                </ol>
              </div>
            </div>
            <div class="show-list-card">
              <h3 class="show-list-time">5:10 pm - 5:40 pm</h3>
              <ul class="show-list">
                <li>特邀嘉宾：走起乐队 Special Guest: StartUp Band</li>
              </ul>
            </div>
            <div style="padding-bottom: 1rem; text-align: center; color: rgb(92, 92, 92)">
              Produced by 载歌在谷
            </div>`;

      const sponsorsHTMLContent = `
      <div class="sponsor-container">
              <div class="sponsor-tab-group" id="sponsorTabGroup">
                <div
                  class="sponsor-tab sponsor-tab__active"
                  id="sponsorTab0"
                  data-i18n-label="sponsor.tab.guide"
                >
                  赞助商
                </div>
                <div
                  class="sponsor-tab sponsor-tab__inactive"
                  id="sponsorTab1"
                  data-i18n-label="sponsor.tab.shows"
                >
                  友情合作
                </div>
              </div>
              <div id="sponsorTabContainer">
                <div id="sponsorLogoGroup">
                </div>
              </div>
              <div id="sponsorDetailsContainer"></div>
            </div>`;
    </script>
  </head>
  <body>
    <div>
      <!-- 测试按钮 -->
      <button
        onclick="function clearCookies() {Cookies.remove('phone'); Cookies.remove('collectedStamps')} clearCookies()"
        style="position: absolute; top: 0; right: 0"
      >
        删除登记信息
      </button>

      <!-- <div id="top-info">
        <div id="pay-info">
          <span data-i18n-label="payInfo.coin"> </span>
          <span data-i18n-label="payInfo.cash"> </span>
        </div>
        <div id="change-lang">
          <span data-i18n-label="langSwitch"> </span>
        </div>
      </div> -->
      <div id="map-container">
        <img id="map" alt="" />
      </div>

      <div id="registerPopup" class="display-none">
        <div id="registerPopupCloseBtn" class="btn-close">×</div>
        <h1>输入手机号</h1>
        <p style="margin: 0 4rem 1rem 4rem">
          输入手机号来获取您的专属二维码。可以用来在支持的摊位进行打卡。收集打卡记录可以换取礼品。
        </p>
        <div style="justify-content: center; display: flex">
          <input
            id="phoneNumber"
            type="tel"
            pattern="[0-9]{10}"
            required
            placeholder="格式：1234567890"
            style="height: 2rem; width: 100%; margin: 0 4rem; border-radius: 0.7rem"
          />
        </div>
        <div style="display: flex; margin-top: 1rem; justify-content: center">
          <button
            id="confirmPhone"
            disabled
            style="
              margin: 0 4rem;
              background: #ffd400;
              border: 1px #f5be00 solid;
              width: 100%;
              height: 2rem;
              border-radius: 0.7rem;
            "
          >
            确认
          </button>
        </div>
      </div>

      <div id="checkinHistoryPopup" class="display-none">
        <div id="checkinHistoryPopupCloseBtn" class="btn-close">×</div>
        <h1>打卡记录</h1>

        <div>
          <p>你已经收集了 <span id="stampCount">0</span> 个</p>
          <p>凭打卡记录在兑奖处领奖</p>
        </div>

        <div class="stamp-cards-list" id="stampCardsList"></div>
      </div>

      <div id="boothListPopup" class="display-none">
        <div id="boothListPopupCloseBtn" class="btn-close">×</div>
        <div id="returnToBoothListBtn" class="display-none">
          <img src="/images/2024-map/arrow.png" alt="" />
        </div>
        <h1 id="sectionName"></h1>
        <div id="boothList"></div>
        <div id="boothDetails"></div>
      </div>

      <div id="qrCodePopup" class="display-none">
        <div id="qrCodePopupCloseBtn" class="btn-close">×</div>
        <h1>我的二维码</h1>
        <p>使用的手机号：<span id="registeredPhone"></span></p>
        <div id="qrCodeContainer"></div>
      </div>

      <div id="drawer">
        <div class="checkin-button-container" id="checkinButtonContainer"></div>

        <!-- 显示打卡页面 -->
        <div id="drawer-slider-container">
          <button id="drawer-slider"></button>
        </div>
        <div class="drawer-tab-group" id="drawerTabGroup">
          <div
            class="drawer-tab drawer-tab__active"
            id="drawerTab0"
            data-i18n-label="drawer.tab.guide"
          >
            游园指南
          </div>
          <div
            class="drawer-tab drawer-tab__inactive"
            id="drawerTab1"
            data-i18n-label="drawer.tab.shows"
          >
            节目单
          </div>
          <div
            class="drawer-tab drawer-tab__inactive"
            id="drawerTab2"
            data-i18n-label="drawer.tab.guide.sponsors"
          >
            赞助&合作
          </div>
        </div>
        <div class="drawer-content__container">
          <div id="drawer-content">
            <img src="/images/2024-map/tourGuide.png" alt="游园指南" />
          </div>
        </div>
      </div>
    </div>
  </body>

  <!-- 获取全局 DOM -->
  <script>
    // 弹窗
    const boothListPopupEle = document.querySelector('#boothListPopup');
    const checkinHistoryPopupEle = document.querySelector('#checkinHistoryPopup');
    const registerPopupEle = document.querySelector('#registerPopup');
    const qrCodePopupEle = document.querySelector('#qrCodePopup');

    // 摊位相关
    const boothListEle = document.querySelector('#boothList');
    const boothListPopupCloseBtnEle = document.querySelector('#boothListPopupCloseBtn');
    const sectionNameEle = document.querySelector('#sectionName');
    const boothDetailsEle = document.querySelector('#boothDetails');
    const returnToBoothListBtnEle = document.querySelector('#returnToBoothListBtn');
  </script>

  <!-- 中英切换 -->
  <!-- <script>
    const allI18nEles = document.querySelectorAll('[data-i18n-label]');

    allI18nEles.forEach((e) => {
      const i18nLabel = e.getAttribute('data-i18n-label');

      e.innerHTML = i18nStrings[i18nLabel][siteStates.selectedLanguage];
    });
  </script> -->
  <!-- 摊位信息弹窗 -->
  <script>
    // boothListEle.onclick = (e) => {
    //   openBoothDetails(e);
    // };

    boothListPopupCloseBtnEle.onclick = () => {
      closePopup(boothListPopupEle);
      document.querySelector('#boothDetails')?.classList.add('display-none');
      document.querySelector('#returnToBoothListBtn')?.classList.add('display-none');
      document.querySelector('#boothList')?.classList.remove('display-none');
    };

    returnToBoothListBtnEle.onclick = returnToBoothList;
  </script>
  <!-- pan zoom map script -->
  <script>
    class TouchDragEvent {
      maxScale = 5;
      minScale = 1;
      initialWidth;
      initialHeight;
      initialLeft;
      initialTop;

      translateXLeftLimit;
      translateYUpperLimit = 0;

      translateXRightLimit = 0;
      translateYLowerLimit = 0;

      preTouchPosition = {};
      translateX = 0;
      translateY = 0;
      scaleRatio = 1;
      scaleOrigin = {
        x: 0,
        y: 0,
      };
      preTouchesClientx1y1x2y2;
      originHaveSet = false;

      img;
      naturalWidth;
      naturalHeight;

      area = {
        cuisine: {
          left: 0,
          right: 0,
          top: 0,
          bottom: 0,
        },
      };

      constructor(img) {
        this.img = img;
        img.src = mapURL;
        img.onload = () => {
          this.calculateInitialSize();

          this.reset();
          this.naturalWidth = this.img.naturalWidth;
          this.naturalHeight = this.img.naturalHeight;
          this.area = {
            cuisine: {
              left: 170 / this.naturalWidth,
              top: 340 / this.naturalHeight,
              right: 351 / this.naturalWidth,
              bottom: 442 / this.naturalHeight,
            },
            kids: {
              left: 228 / this.naturalWidth,
              top: 485 / this.naturalHeight,
              right: 483 / this.naturalWidth,
              bottom: 588 / this.naturalHeight,
            },
            traditions1: {
              left: 104 / this.naturalWidth,
              top: 633 / this.naturalHeight,
              right: 544 / this.naturalWidth,
              bottom: 698 / this.naturalHeight,
            },
            traditions2: {
              left: 525 / this.naturalWidth,
              top: 446 / this.naturalHeight,
              right: 635 / this.naturalWidth,
              bottom: 626 / this.naturalHeight,
            },
            functions1: {
              left: 154 / this.naturalWidth,
              top: 741 / this.naturalHeight,
              right: 518 / this.naturalWidth,
              bottom: 805 / this.naturalHeight,
            },
            functions2: {
              left: 519 / this.naturalWidth,
              top: 315 / this.naturalHeight,
              right: 622 / this.naturalWidth,
              bottom: 420 / this.naturalHeight,
            },
          };
          // console.log('this.area', JSON.stringify(this.area));
          // console.log('initialWidth', this.initialWidth);
          // console.log('initialHeight', this.initialHeight);
          // console.log('naturalWidth', this.naturalWidth);
          // console.log('naturalHeight', this.naturalHeight);
        };

        img.ontouchstart = this.onTouchstart.bind(this);
        img.ontouchmove = this.onTouchmove.bind(this);
        img.ontouchend = this.onTouchend.bind(this);
        img.ontouchcancel = this.ontouchcancel.bind(this);

        img.onclick = this.onClick.bind(this);
      }

      calculateInitialSize() {
        if (this.naturalWidth < this.naturalHeight) {
          this.setDisplaySize(
            screen.width,
            (screen.width / this.naturalWidth) * this.naturalHeight
          );
        } else if (this.naturalWidth > this.naturalHeight) {
          this.setDisplaySize(
            (screen.width / this.naturalHeight) * this.naturalWidth,
            screen.width
          );
        } else {
          this.setDisplaySize(screen.width, screen.width);
        }
      }

      setDisplaySize(width, height) {
        this.initialWidth = width;
        this.initialHeight = height;

        if (this.initialWidth >= 280) {
          this.initialLeft = -(this.initialWidth - 280) / 2;
        }

        if (this.initialHeight >= 280) {
          this.initialTop = -(this.initialHeight - 280) / 2;
        }
      }

      reset() {
        this.translateXLeftLimit = 0;
        this.translateYUpperLimit = 0;

        this.translateXRightLimit = 0;
        this.translateYLowerLimit = 0;

        this.preTouchPosition = {};
        this.translateX = 0;
        this.translateY = 0;
        this.scaleRatio = 1;
        this.scaleOrigin = {
          x: 0,
          y: 0,
        };
        this.preTouchesClientx1y1x2y2 = undefined;
        this.originHaveSet = false;
        this.setStyle('transform', 'none');
        this.setStyle('transform-origin', '50% 50%');
      }

      onClick(e) {
        if (siteStates.isDrawerOpen) {
          drawerContentEle.className = 'drawer-close';
          siteStates.isDrawerOpen = false;
          return;
        }

        // 如果有打开的弹窗（不是顶层抽屉），不响应地图点击
        if (siteStates.hasPopupOpen) {
          closePopup(boothListPopupEle);

          // 如果是在摊位详情中，返回列表
          document.querySelector('#boothDetails')?.classList.add('display-none');
          document.querySelector('#returnToBoothListBtn')?.classList.add('display-none');
          document.querySelector('#boothList')?.classList.remove('display-none');

          closePopup(registerPopupEle);
          closePopup(checkinHistoryPopupEle);
          closePopup(registerPopupEle);
          closePopup(qrCodePopupEle);
          return;
        }

        // offsetX 和 offsetY 不会随着缩放平移而变化，可以根据这俩来确定点了哪里。但是不能直接用，因为图片显示的尺寸不同屏幕不一样，得按照百分比算
        const x = e.offsetX;
        const y = e.offsetY;

        const xPercent = x / this.img.clientWidth;
        const yPercent = y / this.img.clientHeight;

        // console.log('offsetX', e.offsetX);
        // console.log('offsetY', e.offsetY);
        // console.log('xPercent', xPercent);
        // console.log('yPercent', yPercent);
        // console.log('initialWidth', this.initialWidth);
        // console.log('initialHeight', this.initialHeight);
        // console.log('this.img.clientHeight', this.img.clientHeight);
        // console.log('this.img.clientWidth', this.img.clientWidth);

        if (
          xPercent >= this.area.cuisine.left &&
          xPercent <= this.area.cuisine.right &&
          yPercent >= this.area.cuisine.top &&
          yPercent <= this.area.cuisine.bottom
        ) {
          showBoothListPopupFunc('cuisine');
        } else if (
          xPercent >= this.area.kids.left &&
          xPercent <= this.area.kids.right &&
          yPercent >= this.area.kids.top &&
          yPercent <= this.area.kids.bottom
        ) {
          showBoothListPopupFunc('kids');
        } else if (
          (xPercent >= this.area.traditions1.left &&
            xPercent <= this.area.traditions1.right &&
            yPercent >= this.area.traditions1.top &&
            yPercent <= this.area.traditions1.bottom) ||
          (xPercent >= this.area.traditions2.left &&
            xPercent <= this.area.traditions2.right &&
            yPercent >= this.area.traditions2.top &&
            yPercent <= this.area.traditions2.bottom)
        ) {
          showBoothListPopupFunc('traditions');
        } else if (
          (xPercent >= this.area.functions1.left &&
            xPercent <= this.area.functions1.right &&
            yPercent >= this.area.functions1.top &&
            yPercent <= this.area.functions1.bottom) ||
          (xPercent >= this.area.functions2.left &&
            xPercent <= this.area.functions2.right &&
            yPercent >= this.area.functions2.top &&
            yPercent <= this.area.functions2.bottom)
        ) {
          showBoothListPopupFunc('functions');
        }
      }

      // @HostListener('touchstart', ['$event'])
      onTouchstart(e) {
        let touches = e.touches;
        if (touches.length > 1) {
          let one = touches['0'];
          let two = touches['1'];
          this.preTouchesClientx1y1x2y2 = [one.clientX, one.clientY, two.clientX, two.clientY];
          this.originHaveSet = false;
        }
        this.recordPreTouchPosition(touches['0']);
      }

      // @HostListener('touchmove', ['$event'])
      onTouchmove(e) {
        let touches = e.touches;

        if (touches.length === 1) {
          let oneTouch = touches['0'];
          let translated = this.getTranslate(oneTouch.target);
          this.translateX = oneTouch.clientX - this.preTouchPosition.x + translated.left;
          this.translateY = oneTouch.clientY - this.preTouchPosition.y + translated.top;

          this.limitImageBorder();

          if (this.scaleRatio !== 1) {
            let matrix = `matrix(${this.scaleRatio}, 0, 0, ${this.scaleRatio}, ${this.translateX}, ${this.translateY})`;
            this.setStyle('transform', matrix);
          }

          this.recordPreTouchPosition(oneTouch);
        } else {
          let one = touches['0'];
          let two = touches['1'];
          this.scaleRatio =
            (this.distance(one.clientX, one.clientY, two.clientX, two.clientY) /
              this.distance(...this.preTouchesClientx1y1x2y2)) *
              this.scaleRatio || 1;
          if (this.scaleRatio > this.maxScale) {
            this.scaleRatio = this.maxScale;
          }
          if (this.scaleRatio < this.minScale) {
            this.scaleRatio = this.minScale;
          }

          if (!this.originHaveSet) {
            this.originHaveSet = true;
            // 移动视线中心
            let origin = this.relativeCoordinate(
              (one.clientX + two.clientX) / 2,
              (one.clientY + two.clientY) / 2,
              this.img.getBoundingClientRect()
            );
            // 修正视野变化带来的平移量
            this.translateX =
              (this.scaleRatio - 1) * (origin.x - this.scaleOrigin.x) + this.translateX;
            this.translateY =
              (this.scaleRatio - 1) * (origin.y - this.scaleOrigin.y) + this.translateY;

            this.setStyle('transform-origin', `${origin.x}px ${origin.y}px`);
            this.scaleOrigin = origin;
          }

          this.limitImageBorder();
          let matrix = `matrix(${this.scaleRatio}, 0, 0, ${this.scaleRatio}, ${this.translateX}, ${this.translateY})`;
          this.setStyle('transform', matrix);
          this.preTouchesClientx1y1x2y2 = [one.clientX, one.clientY, two.clientX, two.clientY];
        }
        e.preventDefault();
      }

      // 触摸点离开时更新最后位置
      // @HostListener('touchend', ['$event'])
      onTouchend(e) {
        let touches = e.touches;
        if (touches.length === 1) {
          this.recordPreTouchPosition(touches['0']);
        }
        if (this.scaleRatio === 1) {
          this.reset();
        }
      }

      // @HostListener('touchcancel', ['$event'])
      ontouchcancel(e) {
        let touches = e.touches;
        if (touches.length === 1) {
          this.recordPreTouchPosition(touches['0']);
        }
        if (this.scaleRatio === 1) {
          this.reset();
        }
      }

      limitImageBorder() {
        this.translateXLeftLimit = (this.scaleRatio - 1) * this.scaleOrigin.x - this.initialLeft; // 已正确
        this.translateXRightLimit =
          -(this.scaleRatio - 1) * (this.initialWidth - this.scaleOrigin.x) + this.initialLeft;

        this.translateYUpperLimit = (this.scaleRatio - 1) * this.scaleOrigin.y - this.initialTop; // 已正确
        this.translateYLowerLimit =
          -(this.scaleRatio - 1) * (this.initialHeight - this.scaleOrigin.y) + this.initialTop; // 已正确

        if (this.translateY > this.translateYUpperLimit) {
          this.translateY = this.translateYUpperLimit;
        } else if (this.translateY < this.translateYLowerLimit) {
          this.translateY = this.translateYLowerLimit;
        }

        if (this.translateX > this.translateXLeftLimit) {
          this.translateX = this.translateXLeftLimit;
        } else if (this.translateX < this.translateXRightLimit) {
          this.translateX = this.translateXRightLimit;
        }
      }

      getStyle(target, style) {
        let styles = window.getComputedStyle(target, null);
        return styles.getPropertyValue(style);
      }

      getTranslate(target) {
        let matrix = this.getStyle(target, 'transform');
        let nums = matrix.substring(7, matrix.length - 1).split(', ');
        let left = parseInt(nums[4]) || 0;
        let top = parseInt(nums[5]) || 0;
        return {
          left: left,
          top: top,
        };
      }

      recordPreTouchPosition(touch) {
        this.preTouchPosition = {
          x: touch.clientX,
          y: touch.clientY,
        };
      }

      relativeCoordinate(x, y, rect) {
        let cx = (x - rect.left) / this.scaleRatio;
        let cy = (y - rect.top) / this.scaleRatio;
        return {
          x: cx,
          y: cy,
        };
      }

      setStyle(key, value) {
        this.img.style[key] = value;
      }

      distance(x1, y1, x2, y2) {
        let a = x1 - x2;
        let b = y1 - y2;
        return Math.sqrt(a * a + b * b);
      }
    }

    // 使用方法
    let imgElement = document.querySelector('img'); // 选择需要绑定事件的图片元素
    new TouchDragEvent(imgElement);
  </script>

  <!-- drawer script -->
  <script>
    const drawerSliderEle = document.getElementById('drawer-slider');
    const drawerContentEle = document.getElementById('drawer-content');
    const drawerTabGroupEle = document.getElementById('drawerTabGroup');
    let isDrawerOpen = false;

    function toggleDrawer() {
      siteStates.isDrawerOpen = !siteStates.isDrawerOpen;

      if (siteStates.isDrawerOpen) {
        drawerContentEle.className = 'drawer-open';
      } else {
        drawerContentEle.className = 'drawer-close';
      }
    }

    function openDrawer() {
      siteStates.isDrawerOpen = true;

      drawerContentEle.className = 'drawer-open';
      drawerContentEle.parentNode.scrollTop = 0;
    }

    drawerSliderEle.onclick = toggleDrawer;
    drawerTabGroup.onclick = openDrawer;
  </script>

  <!-- 顶层切换tab -->
  <script>
    const tourTab = document.querySelector('#drawerTabGroup > #drawerTab0');
    const showListTab = document.querySelector('#drawerTabGroup > #drawerTab1');
    const sponsorsTab = document.querySelector('#drawerTabGroup > #drawerTab2');
    const tabContainer = document.querySelector('#drawer-content');

    tourTab.onclick = () => {
      tourTab.classList.remove('drawer-tab__inactive');
      tourTab.classList.add('drawer-tab__active');

      showListTab.classList.add('drawer-tab__inactive');
      showListTab.classList.remove('drawer-tab__active');

      sponsorsTab.classList.add('drawer-tab__inactive');
      sponsorsTab.classList.remove('drawer-tab__active');
      tabContainer.innerHTML = tourGuideHTMLContent;
      drawerContentEle.parentNode.scrollTop = 0;
    };

    showListTab.onclick = () => {
      showListTab.classList.remove('drawer-tab__inactive');
      showListTab.classList.add('drawer-tab__active');

      tourTab.classList.add('drawer-tab__inactive');
      tourTab.classList.remove('drawer-tab__active');

      sponsorsTab.classList.add('drawer-tab__inactive');
      sponsorsTab.classList.remove('drawer-tab__active');

      tabContainer.innerHTML = showListHTMLContent;
      drawerContentEle.parentNode.scrollTop = 0;
    };

    sponsorsTab.onclick = () => {
      sponsorsTab.classList.remove('drawer-tab__inactive');
      sponsorsTab.classList.add('drawer-tab__active');

      tourTab.classList.add('drawer-tab__inactive');
      tourTab.classList.remove('drawer-tab__active');

      showListTab.classList.add('drawer-tab__inactive');
      showListTab.classList.remove('drawer-tab__active');

      tabContainer.innerHTML = sponsorsHTMLContent;
      drawerContentEle.parentNode.scrollTop = 0;

      bindSponsorTabEvents();
    };
  </script>

  <!-- 赞助商子tab切换 -->
  <script>
    function showSponsorInfo(sponsorKey, sponsorDetailsContainer) {
      const qrImages = sponsorsAndCollaboratorsMap[sponsorKey].qrCode
        .map((code) => {
          return `<img class="sponsor-qr" src="${code}"/>`;
        })
        .join('');
      sponsorDetailsContainer.innerHTML = `
        <div>
          <p class="sponsor-details">${sponsorsAndCollaboratorsMap[sponsorKey].details ?? ''}</p>
          ${qrImages}
        </div>
        `;
    }
    function selectSponsor(e, sponsorDetailsContainer) {
      if (e.target.classList.contains('logo-img')) {
        const sponsorKey = e.target.getAttribute('data-sponsor');
        let inputEle;

        for (let item of e.target.parentNode.parentNode.children) {
          if (item.nodeName === 'INPUT') {
            inputEle = item;
          }
        }
        inputEle.checked = true;
        showSponsorInfo(sponsorKey, sponsorDetailsContainer);
      }
    }
    function bindSponsorTabEvents() {
      const sponsorTab1 = document.querySelector('#sponsorTabGroup > #sponsorTab0');
      const sponsorTab2 = document.querySelector('#sponsorTabGroup > #sponsorTab1');
      const sponsorLogoGroup = document.querySelector('#sponsorLogoGroup');
      const sponsorDetailsContainer = document.querySelector('#sponsorDetailsContainer');

      function activateTab1() {
        sponsorTab1.classList.remove('sponsor-tab__inactive');
        sponsorTab1.classList.add('sponsor-tab__active');

        sponsorTab2.classList.add('sponsor-tab__inactive');
        sponsorTab2.classList.remove('sponsor-tab__active');

        sponsorLogoGroup.innerHTML = sponsorsListHTML;
        sponsorLogoGroup.scrollLeft = 0;

        document.querySelectorAll('.active-selected-sponsor').checked = true;

        sponsorLogoGroup.onclick = (e) => {
          selectSponsor(e, sponsorDetailsContainer);
        };
        showSponsorInfo(sponsorsList[0], sponsorDetailsContainer);
      }

      function activateTab2() {
        sponsorTab2.classList.remove('sponsor-tab__inactive');
        sponsorTab2.classList.add('sponsor-tab__active');

        sponsorTab1.classList.add('sponsor-tab__inactive');
        sponsorTab1.classList.remove('sponsor-tab__active');

        sponsorLogoGroup.innerHTML = collaboratorsListHTML;
        sponsorLogoGroup.scrollLeft = 0;

        sponsorLogoGroup.onclick = (e) => {
          selectSponsor(e, sponsorDetailsContainer);
        };
        showSponsorInfo(collaboratorsList[0], sponsorDetailsContainer);
      }

      activateTab1();

      sponsorTab1.onclick = activateTab1;

      sponsorTab2.onclick = activateTab2;
    }
  </script>

  <!--打卡记录弹窗，注册生成二维码 -->
  <script>
    const registeredCheckinButtonsHTML = `<div class="checkin-button" id="showCheckinHistory">
            <img class="checkin-button-logo" src="/images/2024-map/zgzglogo.png" alt="" />
            查看打卡记录
          </div>
          <div class="checkin-button" id="showQRCode">
            <img class="checkin-button-logo" style="height: 76%;" src="/images/2024-map/my-qr-code.png" alt="" />
            我的二维码
          </div>`;
    const unregisteredCheckinButtonsHTML = `<div class="checkin-button" id="checkinButton">
            <img class="checkin-button-logo"  src="/images/2024-map/zgzglogo.png" alt="" />
            登记以获取打卡二维码
          </div>`;

    const stampCardsListEle = document.querySelector('#stampCardsList');
    const stampCountEle = document.querySelector('#stampCount');

    const confirmPhoneEle = document.querySelector('#confirmPhone');
    const phoneEle = document.querySelector('#phoneNumber');

    function showCheckinhistory() {
      if (Cookies.get('phone')) {
        openStampPopup();
        // 更新摊位列表中打卡信息
        cuisinesListHTML = generateBoothListHTML(cuisinesList, sectionNames.cuisine);
        kidsListHTML = generateBoothListHTML(kidsList, sectionNames.kids);
        traditionsListHTML = generateBoothListHTML(traditionsList, sectionNames.traditions);
        functionsListHTML = generateBoothListHTML(functionsList, sectionNames.functions);
      } else {
        openPopup(registerPopupEle);
      }
    }

    if (Cookies.get('phone')) {
      generateQR();
      document.querySelector('#checkinButtonContainer').innerHTML = registeredCheckinButtonsHTML;

      if (document.querySelector('#showQRCode')) {
        document.querySelector('#showQRCode').onclick = () => {
          openPopup(qrCodePopupEle);
        };
        document.querySelector('#showCheckinHistory').onclick = showCheckinhistory;

        document.querySelector('#qrCodeContainer').appendChild(siteStates.qrCodeEle);
        document.querySelector('#registeredPhone').innerHTML = Cookies.get('phone');
      }
    } else {
      document.querySelector('#checkinButtonContainer').innerHTML = unregisteredCheckinButtonsHTML;
      document.querySelector('#checkinButton').onclick = () => {
        openPopup(registerPopupEle);
      };
    }

    async function openStampPopup() {
      const querySnapshot = await window.getDocs(window.firebaseQuery);

      const stampCards = [];
      const collectedStamps = new Set(Cookies.getJSON('collectedStamps') ?? []);

      // querySnapshot.forEach((doc) => {
      // const boothIndex = doc.data().booth;
      ['cuisine-2', 'cuisine-8', 'kids-1'].forEach((doc) => {
        const boothIndex = doc;

        collectedStamps.add(boothIndex);
        const boothName =
          allBooths.find((booth) => booth.stampIndex === boothIndex)?.name ?? '未知摊位';
        stampCards.push(`<div class="stamp-card">
          <div class="stamp-name">${boothName}</div>
          <img src="/images/2024-map/zgzglogo.png" alt="" />
        </div>`);
      });

      Cookies.set('collectedStamps', Array.from(collectedStamps));

      stampCountEle.innerHTML = stampCards.length;

      stampCardsListEle.innerHTML = stampCards.join('');

      openPopup(checkinHistoryPopupEle);
    }

    function register() {
      if (phoneEle.checkValidity()) {
        Cookies.set('phone', phoneEle.value);
        generateQR();
        document.querySelector('#checkinButtonContainer').innerHTML = registeredCheckinButtonsHTML;
        document.querySelector('#showCheckinHistory').onclick = showCheckinhistory;
        alert('注册成功，请点击主界面“我的二维码”按钮查看');

        closePopup(registerPopupEle);
        document.querySelector('#showQRCode').onclick = () => {
          openPopup(qrCodePopupEle);
        };

        document.querySelector('#qrCodeContainer').appendChild(siteStates.qrCodeEle);
      } else {
        alert('请输入手机号');
      }
    }

    function validatePhone(e) {
      phoneEle.checkValidity();

      if (phoneEle.checkValidity()) {
        confirmPhoneEle.disabled = false;
      } else {
        confirmPhoneEle.disabled = true;
      }
    }

    document.querySelector('#checkinHistoryPopupCloseBtn').onclick = () => {
      closePopup(checkinHistoryPopupEle);
    };
    document.querySelector('#registerPopupCloseBtn').onclick = () => {
      closePopup(registerPopupEle);
    };
    document.querySelector('#qrCodePopupCloseBtn').onclick = () => {
      closePopup(qrCodePopupEle);
    };
    confirmPhoneEle.onclick = register;
    phoneEle.oninput = validatePhone;
  </script>
</html>
